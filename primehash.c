#include "primehash.h"

// defintions
#define BIGPRIME 0x7BE9DE4ACD9

// variables
static const unsigned long int primes[] = 
{
	0x3, 0x5, 0x7, 0xb, 0xd, 0x11, 0x13, 0x17,
	0x1d, 0x1f, 0x25, 0x29, 0x2b, 0x2f, 0x35, 0x3b,
	0x3d, 0x43, 0x47, 0x49, 0x4f, 0x53, 0x59, 0x61,
	0x65, 0x67, 0x6b, 0x6d, 0x71, 0x7f, 0x83, 0x89,
	0x8b, 0x95, 0x97, 0x9d, 0xa3, 0xa7, 0xad, 0xb3,
	0xb5, 0xbf, 0xc1, 0xc5, 0xc7, 0xd3, 0xdf, 0xe3,
	0xe5, 0xe9, 0xef, 0xf1, 0xfb, 0x101, 0x107, 0x10d,
	0x10f, 0x115, 0x119, 0x11b, 0x125, 0x133, 0x137, 0x139,
	0x13d, 0x14b, 0x151, 0x15b, 0x15d, 0x161, 0x167, 0x16f,
	0x175, 0x17b, 0x17f, 0x185, 0x18d, 0x191, 0x199, 0x1a3,
	0x1a5, 0x1af, 0x1b1, 0x1b7, 0x1bb, 0x1c1, 0x1c9, 0x1cd,
	0x1cf, 0x1d3, 0x1df, 0x1e7, 0x1eb, 0x1f3, 0x1f7, 0x1fd,
	0x209, 0x20b, 0x21d, 0x223, 0x22d, 0x233, 0x239, 0x23b,
	0x241, 0x24b, 0x251, 0x257, 0x259, 0x25f, 0x265, 0x269,
	0x26b, 0x277, 0x281, 0x283, 0x287, 0x28d, 0x293, 0x295,
	0x2a1, 0x2a5, 0x2ab, 0x2b3, 0x2bd, 0x2c5, 0x2cf, 0x2d7,
	0x2dd, 0x2e3, 0x2e7, 0x2ef, 0x2f5, 0x2f9, 0x301, 0x305,
	0x313, 0x31d, 0x329, 0x32b, 0x335, 0x337, 0x33b, 0x33d,
	0x347, 0x355, 0x359, 0x35b, 0x35f, 0x36d, 0x371, 0x373,
	0x377, 0x38b, 0x38f, 0x397, 0x3a1, 0x3a9, 0x3ad, 0x3b3,
	0x3b9, 0x3c7, 0x3cb, 0x3d1, 0x3d7, 0x3df, 0x3e5, 0x3f1,
	0x3f5, 0x3fb, 0x3fd, 0x407, 0x409, 0x40f, 0x419, 0x41b,
	0x425, 0x427, 0x42d, 0x43f, 0x443, 0x445, 0x449, 0x44f,
	0x455, 0x45d, 0x463, 0x469, 0x47f, 0x481, 0x48b, 0x493,
	0x49d, 0x4a3, 0x4a9, 0x4b1, 0x4bd, 0x4c1, 0x4c7, 0x4cd,
	0x4cf, 0x4d5, 0x4e1, 0x4eb, 0x4fd, 0x4ff, 0x503, 0x509,
	0x50b, 0x511, 0x515, 0x517, 0x51b, 0x527, 0x529, 0x52f,
	0x551, 0x557, 0x55d, 0x565, 0x577, 0x581, 0x58f, 0x593,
	0x595, 0x599, 0x59f, 0x5a7, 0x5ab, 0x5ad, 0x5b3, 0x5bf,
	0x5c9, 0x5cb, 0x5cf, 0x5d1, 0x5d5, 0x5db, 0x5e7, 0x5f3,
	0x5fb, 0x607, 0x60d, 0x611, 0x617, 0x61f, 0x623, 0x62b,
	0x62f, 0x63d, 0x641, 0x647, 0x649, 0x64d, 0x653, 0x655
};

struct phash hash(char *str)
{
	struct phash out;
	char curchar;
	int i;

	out.dig = 1;
	out.xorsig = 0xFF;
	i = 0;
	while (1) {
		curchar = *(str + i);
		if (curchar == 0) break;
		out.xorsig ^= curchar;
		out.dig *= primes[curchar];
		out.dig += 1;
		i++;
	};
	out.dig += (*str & out.xorsig);

	return out;
}
